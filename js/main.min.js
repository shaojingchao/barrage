!function(t,e){function i(){return{fontSize:e('[name="f_size"]').val(),text:e('input[name="f_text"]').val(),color:e('[name="f_color"]:checked').val(),time:e('[name="f_time"]').val()}}function n(i){var n=this;this.itemPos={},this.box=new Array(i),this.getIndex=function(){var i=[],s=this.box,o=this;e.each(s,function(t,n){if(void 0===n)i.push(t);else{var s=e("[data-id="+n+"]");if(s.length>0){var r=s.get(0).getBoundingClientRect();o.itemPos[n].right=parseInt(r.right)}}});var r=i.length,a=parseInt(r*Math.random()),h=function(i){var s,o=[],r=[];for(s in i){var a=i[s].index;o.indexOf(a)>-1?(n.box[a]=s,o[o.indexOf(a)]=a,r[o.indexOf(a)]=i[s].right):(o.push(i[s].index),r.push(i[s].right))}var h=Math.min.apply(null,r);return!(h+6>e(t).width())&&o[r.indexOf(h)]}(o.itemPos);return r>0?i[a]:!1!==h&&h},this.add=function(t){var e=this.getIndex();return!1!==e&&(this.itemPos[t]={},this.itemPos[t].index=e,this.box[e]=t,this.itemPos[t])},this.del=function(t){this.itemPos[t]&&(delete this.itemPos[t],this.box=this.box.map(function(e){return e===t?void 0:e}))}}function s(t){function i(t){n.$el.find(".J_bulList").append(o),o.attr("data-id",h);var i="-"+(r.width+100+o.innerWidth())+"px",s='{"top":"'+45*t.index+'px","transform":"translate'+(Modernizr.csstransforms3d?"3d("+i+",0,0)":"("+i+")")+'","transition":"transform '+a+'s linear"}';o.css(e.parseJSON(PrefixFree.prefixCSS(s))),setTimeout(function(){o.remove(),n.nextPos.del(h)},1e3*a)}var n=this,s=e.extend({},this._opts.config,t),o=e(tmpl(this._opts.itemTpl,[s])),r=this._size,a=parseInt(s.time),h=(new Date).getTime()+"",l=n.nextPos.add(h),d=null;!1===l?(clearInterval(d),d=setInterval(function(){(l=n.nextPos.add(h))&&(clearInterval(d),i(l))},100)):i(l)}function o(t){var n=this,o=n._opts.config.delay;null==t&&(t=i()),e.isArray(t)?e.each(t,function(t,e){!function(t){setTimeout(function(){s.call(n,e)},t)}(t*o)}):s.call(n,t)}var r={color:"#fff",fontSize:"30px",time:"5",delay:300,text:"这是一条弹幕。"},a=function(t,i,s){return this.$el=t,this._opts=s,this._default=r,this._opts.config=null!=s.config?e.extend({},r,s.config):r,this._size={height:t.innerHeight(),width:t.innerWidth()},this.maxLen=parseInt(.7*this._size.height/45),this.nextPos=new n(this.maxLen),o.call(this,i),this};a.fn=a.prototype,a.prototype={addBul:o,getBullet:i},null==window.tmpl&&console.error("请先加载 blueimp-JavaScript-Templates 插件"),t.Bullet=a}(window,jQuery);
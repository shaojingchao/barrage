!function(t,i){function e(){return{fontSize:i('[name="f_size"]').val(),text:i('input[name="f_text"]').val(),color:i('[name="f_color"]:checked').val(),time:i('[name="f_time"]').val()}}function n(e){var n=this;this.itemPos={},this.box=new Array(e),this.getIndex=function(){var e=[],o=this.box,s=this;i.each(o,function(t,n){if(void 0===n)e.push(t);else{var o=i("[data-id="+n+"]");if(o.length>0){var a=o.get(0).getBoundingClientRect();s.itemPos[n].right=parseInt(a.right)}}});var a=e.length,r=parseInt(a*Math.random()),h=function(e){var o,s=[],a=[];for(o in e){var r=e[o].index;s.indexOf(r)>-1?(n.box[r]=o,s[s.indexOf(r)]=r,a[s.indexOf(r)]=e[o].right):(s.push(e[o].index),a.push(e[o].right))}var h=Math.min.apply(null,a);return!(h+6>i(t).width())&&s[a.indexOf(h)]}(s.itemPos);return a>0?e[r]:!1!==h&&h},this.add=function(t){var i=this.getIndex();return!1!==i&&(this.itemPos[t]={},this.itemPos[t].index=i,this.box[i]=t,this.itemPos[t])},this.del=function(t){this.itemPos[t]&&(delete this.itemPos[t],this.box=this.box.map(function(i){return i===t?void 0:i}))}}function o(t){function e(t){n.$el.find(".J_bulList").append(s),s.attr("data-id",h),s.css({top:45*t.index+"px",transform:"translate(-"+(a.width+s.outerWidth())+"px)",transition:"transform "+r+"s linear"}),setTimeout(function(){s.remove(),n.nextPos.del(h)},1e3*r)}var n=this,o=i.extend({},this._opts.config,t),s=i(tmpl(this._opts.itemTpl,[o])),a=this._size,r=parseInt(o.time),h=(new Date).getTime()+"",l=n.nextPos.add(h),d=null;!1===l?(clearInterval(d),d=setInterval(function(){(l=n.nextPos.add(h))&&(clearInterval(d),e(l))},100)):e(l)}function s(t){var n=this,s=n._opts.config.delay;null==t&&(t=e()),i.isArray(t)?i.each(t,function(t,i){!function(t){setTimeout(function(){o.call(n,i)},t)}(t*s)}):o.call(n,t)}var a={color:"#fff",fontSize:"30px",time:"5",delay:300,text:"这是一条弹幕。"},r=function(t,e,o){return this.$el=t,this._opts=o,this._default=a,this._opts.config=null!=o.config?i.extend({},a,o.config):a,this._size={height:t.innerHeight(),width:t.innerWidth()},this.maxLen=parseInt(.7*this._size.height/45),this.nextPos=new n(this.maxLen),s.call(this,e),this};r.fn=r.prototype,r.prototype={addBul:s,getBullet:e},null==window.tmpl&&console.error("请先加载 blueimp-JavaScript-Templates 插件"),t.Bullet=r}(window,jQuery);